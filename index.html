<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>QRコード漢字モードエンコーダー (WASM)</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 800px; margin: auto; }
        .input-area, .results-area, .error-area { margin-bottom: 1.5em; }
        #kanjiInput { font-size: 1.2em; padding: 5px; }
        #runButton { font-size: 1.2em; padding: 5px; }
        h3 { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        table { border-collapse: collapse; width: 100%; margin-top: 1em;}
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-family: monospace;}
        th { background-color: #f2f2f2; }
        pre { background-color: #eee; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; }
        .error { color: red; font-weight: bold; }
    </style>
    <script>
        MathJax = {
          tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
          }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="container">
        <h1>QRコード 漢字モードエンコーダー (WebAssembly版)</h1>
        <div class="input-area">
            <input type="text" id="kanjiInput" size="20" placeholder="漢字を入力 (最大9文字)">
            <button id="runButton">エンコード実行</button>
        </div>

        <div id="status">WASMをロード中です...</div>
        <div id="error-display" class="error-area"></div>

        <div id="results-container" style="display: none;">
            <h3>Step 1-1: 13ビットへの圧縮</h3>
            <table id="compression-table">
                <thead>
                    <tr>
                        <th>漢字</th>
                        <th>Shift-JIS</th>
                        <th>減算</th>
                        <th>圧縮後(16進)</th>
                        <th>13ビットバイナリ</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <h3>Step 1-2, 1-3: 指示子と終端</h3>
            <pre>モード指示子: <code id="mode-indicator"></code></pre>
            <pre>文字数指示子: <code id="char-count-indicator"></code></pre>
            <pre>連結データ: <code id="concatenated-binary"></code></pre>
            <pre>終端パターン追加後: <code id="terminated-binary"></code></pre>
            
            <h3>Step 1-4, 1-5: パディングと埋め草コード語</h3>
            <pre>8ビット単位分割: <code id="padded-binary-blocks"></code></pre>
            <pre>データコード語 (16進): <code id="padded-hex"></code></pre>

            <h3>Step 1-6, 1-7: RS符号の計算と最終符号語</h3>
            <p>データ多項式 $D(x)$: <code id="data-polynomial"></code></p>
            <p>誤り訂正多項式 $R(x)$: <code id="error-correction-polynomial"></code></p>
            <p>符号語多項式 $C(x)$: <code id="codeword-polynomial"></code></p>
            <pre>最終符号語 (16進): <code id="codeword-hex"></code></pre>
            <pre>最終符号語 (2進): <code id="codeword-binary"></code></pre>
        </div>
    </div>

    <script src="wasm_exec.js"></script>
    <script src="app.js"></script>
</body>
</html>